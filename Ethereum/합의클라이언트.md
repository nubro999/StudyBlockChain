
## 합의 클라이언트 (Consensus Client)란?

이더리움은 **더 머지(The Merge)** 업그레이드를 통해 작업 증명(PoW)에서 **지분 증명(PoS)** 방식으로 전환되었습니다. 이 전환으로 이더리움 노드의 구조가 크게 바뀌었는데, 이제 이더리움 노드는 더 이상 하나의 소프트웨어(Geth 같은 실행 클라이언트)만으로 구성되지 않습니다. 대신, **두 가지 종류의 클라이언트가 서로 협력해야 완전한 이더리움 노드로서 기능할 수 있습니다.**

이 두 가지 클라이언트가 바로:

1. **실행 클라이언트 (Execution Client)**: 기존의 Geth와 같은 클라이언트.
    
2. **합의 클라이언트 (Consensus Client)**: 새롭게 추가된 클라이언트.
    

### 1. 실행 클라이언트 (Execution Client) - 예: Geth

**역할:**

- **트랜잭션 처리**: 사용자가 보내는 모든 트랜잭션(이더 전송, 스마트 컨트랙트 호출 등)을 실행하고 검증합니다.
    
- **EVM(Ethereum Virtual Machine) 실행**: 스마트 컨트랙트 코드를 실행하고 그 결과를 처리합니다.
    
- **상태 관리**: 계정 잔액, 컨트랙트 코드, 저장된 데이터 등 이더리움 네트워크의 현재 상태(state)를 관리하고 업데이트합니다.
    
- **블록 콘텐츠 구성**: 실행 클라이언트는 트랜잭션을 수집하여 실행하고, 새로운 블록에 포함될 트랜잭션 데이터와 실행 결과를 담은 **실행 페이로드(Execution Payload)**를 준비합니다.
    

**쉽게 비유하면:** 이더리움이라는 거대한 컴퓨터에서 **CPU와 메모리, 그리고 데이터 처리 로직**을 담당하는 부분입니다. 우리가 실제로 이더리움 위에서 무언가 작동하게 하려면 실행 클라이언트가 필요합니다.

### 2. 합의 클라이언트 (Consensus Client) - 예: Prysm, Lighthouse, Teku, Nimbus, Lodestar

**역할:**

- **네트워크 합의**: 이더리움 네트워크에서 새로운 블록을 어떻게 만들고 검증하여 체인에 추가할 것인지에 대한 **합의 규칙**을 담당합니다. 지분 증명(PoS) 방식에서는 검증자들이 ETH를 스테이킹하고 무작위로 선택되어 블록을 제안하거나 증명합니다. 합의 클라이언트는 이러한 검증자 역할을 수행하고, 네트워크의 분산된 노드들이 체인의 동일한 버전에 동의하도록 합니다.
    
- **블록 제안 및 증명**: 검증자로 선정되면 새로운 블록을 제안하고 다른 검증자들의 증명(attestation)을 받아 체인에 최종 확정합니다.
    
- **네트워크 보안 및 활성 유지**: 악의적인 행동을 감지하고, 네트워크의 무결성을 유지하며, 체인이 계속해서 성장하도록 보장합니다.
    
- **비콘 체인(Beacon Chain) 관리**: 이더리움 2.0 업그레이드(더 머지) 이전부터 PoS 기반의 핵심 역할을 해오던 '비콘 체인'의 상태와 규칙을 담당합니다.
    

**쉽게 비유하면:** 이더리움이라는 거대한 컴퓨터에서 **운영 체제(OS)와 네트워크 관리자, 그리고 투표 시스템**을 담당하는 부분입니다. 누가 어떤 순서로 계산을 할지, 그 결과가 올바른지 어떻게 확인할지 등을 결정합니다.

### 실행 클라이언트와 합의 클라이언트의 협력 (Engine API)

더 머지 이후, Geth와 같은 실행 클라이언트는 독자적으로 작동할 수 없습니다. 실행 클라이언트가 새로운 트랜잭션을 처리하고 블록 콘텐츠를 만들면, 이 정보는 **합의 클라이언트**로 전달됩니다. 합의 클라이언트는 이 콘텐츠를 사용하여 블록을 만들고, 네트워크의 합의 규칙에 따라 이 블록을 다른 노드들에게 전파하고 검증받습니다. 역으로, 합의 클라이언트가 네트워크로부터 새로운 블록을 받아오면, 그 블록에 담긴 트랜잭션 정보를 실행 클라이언트로 전달하여 실제 실행 및 상태 업데이트가 이루어지도록 합니다.

이 두 클라이언트 간의 통신은 **엔진 API (Engine API)**라는 표준화된 인터페이스를 통해 이루어집니다.

### 왜 이 두 가지가 필요한가요?

- **전문성 분리**: 각각의 클라이언트가 특정 기능(실행 vs. 합의)에 전문화되어 개발 및 유지보수가 용이해졌습니다.
    
- **탄력성 및 보안 강화**: 하나의 클라이언트에서 문제가 발생하더라도 전체 네트워크가 멈추지 않고, 다양한 클라이언트 구현체 간의 경쟁을 통해 전체 시스템의 안정성과 보안이 향상됩니다.
    
- **PoS로의 전환**: 지분 증명 방식의 복잡한 합의 로직을 처리하기 위해 별도의 합의 클라이언트가 필요하게 되었습니다.